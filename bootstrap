#!/bin/bash
DOTFILES="${HOME}/.local/dotfiles"
if [ ! -e "${HOME}/nvim-root" ]; then
	curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim.appimage 
	chmod u+x "${HOME}/nvim.appimage"
	sh -c '"${HOME}/nvim.appimage" --appimage-extract'
	mv "${HOME}/squashfs-root" "${HOME}/nvim-root"
	rm "${HOME}/nvim.appimage"
fi
echo "   nvim installed."
echo "adding rcfiles..."
for file in $(find "${DOTFILES}/rcfiles/" -type d); do
	BASENAME=${file#"${DOTFILES}/rcfiles/"}
	mkdir -p "${HOME}/${BASENAME}"
done
for file in $(find "${DOTFILES}/rcfiles/" -type f); do
	BASENAME=${file#"${DOTFILES}/rcfiles/"}
	if [ -e "${HOME}/${BASENAME}" ]; then
		if [ -L "${HOME}/${BASENAME}" ]; then
			echo "    ${BASENAME} linked."
			continue
		else
			echo "    ${BASENAME} exists. backing up..."
			mv "${HOME}/${BASENAME}" "${HOME}/${BASENAME}.bckp"
		fi
	elif [ -L "${HOME}/${BASENAME}" ]; then
		echo "    ${BASENAME} broken link. removing..."
		unlink "${HOME}/${BASENAME}"
	fi
	ln -s "${file}" "${HOME}/${BASENAME}"
	echo "    ${BASENAME} linked."
done
git config --global core.editor "${HOME}/nvim-root/AppRun"
echo "   nvim plugins installed."

echo "all done! relog to see changes."
